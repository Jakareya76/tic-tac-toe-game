!function(e,r){"use strict";e.onerror=function(e,r,t){return!1},e.AudioContext=e.AudioContext||e.webkitAudioContext;var t=function(e){try{return e.setItem("_","_"),e.removeItem("_"),!0}catch(e){return!1}}(e.localStorage),o=r.getElementById("consent"),s=!!o;function a(){(e.adsbygoogle||[]).pauseAdRequests=0,s&&r.body.classList.add("cookies-consent")}function n(){!s||t&&localStorage.getItem("consent")?a():o.addEventListener("click",function(){a(),t&&localStorage.setItem("consent",!0)})}function c(e){var r=new XMLHttpRequest;r.open("GET","/assets/audio/"+e+".mp3",!0),r.responseType="arraybuffer",r.onload=function(){u.decodeAudioData(r.response,function(r){q[e]=r},function(){})},r.send()}function i(e){if(!l&&q[e]){u&&u.resume&&u.resume();var r=u.createBufferSource();r.buffer=q[e],r.connect(u.destination),r.start?r.start(0):r.noteOn(0)}}var u,l,d,f,p={},y={player1:0,player2:0,ties:0},m={player1:0,player2:0,ties:0},v="x",L="o",q={},h=9,g=!0,S=!0,w=!1,b=300,T=.75,M=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];function k(){for(var e=p.mute.length;e--;)p.mute[e].style.display=l?"none":""}function A(e,r){p.squares[r].querySelector("div").classList.add(e)}function D(){var e=p.scores.turn1.classList,r=p.scores.turn2.classList,t=p.scores.turnTies.classList;w&&"none"===p.restart.style.display?(g?(r.remove("turn"),e.add("turn")):(e.remove("turn"),r.add("turn")),t.add("turn")):(e.remove("turn"),r.remove("turn"),t.remove("turn"))}function H(e,r){p.restart.style.display="block",setTimeout(function(){if(setTimeout(function(){d=!1},b),r)for(var t=3;t--;)p.squares[r[t]].classList.add("win");switch(e){case v:p.scores.player1.innerHTML=w?++m.player1:++y.player1,p.scores.player1.classList.add("appear"),p.board.classList.add("win"),i("game-over");break;case L:p.scores.player2.innerHTML=w?++m.player2:++y.player2,p.scores.player2.classList.add("appear"),p.board.classList.add("win"),i("game-over");break;default:p.scores.ties.innerHTML=w?++m.ties:++y.ties,p.scores.ties.classList.add("appear"),p.board.classList.add("tie"),i("game-over-tie")}},g&&!w?100:b+100)}function I(){for(var e=M.length;e--;){var r=M[e],t=f[r[0]]+f[r[1]]+f[r[2]];if(3===t||-3===t)return H(3===t?L:v,r),!0}var o=0;for(e=h;e--;)0!==f[e]&&o++;return 9===o&&(H(),!0)}function x(){if(!I()){var e,r,t,o,s,a,n=0;for(g=!1,D(),i("note-high"),e=h;e--;)0!==f[e]&&1===++n&&(a=e);if(n<2&&Math.random()>.2)do{s=Math.floor(Math.random()*h)}while(s===a);else for(e=h;e--;){for(r=h;r--;)if(0===f[r]){if(f[r]=1,I())return void A(L,r);f[r]=0}if(0===f[e]){f[e]=1;var c=null,u=f.concat();for(r=h;r--;)if(0===u[r]){for(u[r]=-1,t=M.length;t--;)if(u[M[t][0]]+u[M[t][1]]+u[M[t][2]]===-3&&Math.random()>T)return f[e]=0,f[r]=1,A(L,r),void I();var l=0,d=0,p=u.concat(),y=u.concat();for(t=h;t--;)0===p[t]&&(p[t]=1),0===y[t]&&(y[t]=-1);for(t=M.length;t--;)p[M[t][0]]+p[M[t][1]]+p[M[t][2]]===3&&l++,y[M[t][0]]+y[M[t][1]]+y[M[t][2]]===-3&&d++;var m=l-d;c=null==c?m:c>m?m:c,u[r]=0}(null==o||o<c)&&(o=c,s=e),f[e]=0}}f[s]=1,A(L,s),I()}}function C(e){p.squares[e].ontouchstart=p.squares[e].onmousedown=function(r){r.preventDefault(),function(e){0!==f[e]||I()||!w&&g||(w?(g=!g,f[e]=g?-1:1,A(g?v:L,e),i("note-"+(g?"low":"high")),I()):(f[e]=-1,A(v,e),g=!0,i("note-low"),setTimeout(x,b)),D())}(e)}}function B(){if(!d){d=!0,p.restart.style.display="none",f=[0,0,0,0,0,0,0,0,0];for(var e=h;e--;)p.squares[e].classList.remove("win"),p.squares[e].querySelector("div").className="";p.scores.ties.classList.remove("appear"),p.scores.player1.classList.remove("appear"),p.scores.player2.classList.remove("appear"),p.board.classList.remove("win"),p.board.classList.remove("tie"),g=S=!S,D(),S&&!w&&setTimeout(x,b)}}r.addEventListener("DOMContentLoaded",function(){p={board:r.querySelector(".board"),squares:r.querySelectorAll(".square"),restart:r.querySelector(".restart"),muteButton:r.querySelector(".mute"),mute:r.querySelectorAll(".mute path"),privacy:r.querySelector(".privacy"),scores:{scores:r.querySelector(".scores"),swap:r.querySelector(".swap"),player1:r.querySelector(".player1 .score"),player2:r.querySelector(".player2 .score"),ties:r.querySelector(".ties .score"),turn1:r.querySelector(".player1"),turn2:r.querySelector(".player2"),turnTies:r.querySelector(".ties")}};for(var o=h;o--;)C(o);p.restart.ontouchstart=p.scores.scores.ontouchstart=function(e){e.preventDefault()},p.scores.scores.ontouchend=p.scores.scores.onclick=function(e){e.preventDefault(),function(){w=!w;var e=p.scores.scores.classList;w?(e.remove("p1"),e.add("p2"),S=!0):(e.remove("p2"),e.add("p1"),S=!1),p.scores.player1.innerHTML=w?m.player1:y.player1,p.scores.player2.innerHTML=w?m.player2:y.player2,p.scores.ties.innerHTML=w?m.ties:y.ties,d=!1,B()}()},p.restart.ontouchend=p.restart.onclick=function(e){e.preventDefault(),B()},e.AudioContext&&(u=new AudioContext,c("note-high"),c("note-low"),c("game-over"),c("game-over-tie"),l=!!t&&"true"===localStorage.getItem("muted"),k(),p.muteButton.ontouchstart=p.muteButton.onclick=function(e){e.preventDefault(),l=!l,t&&localStorage.setItem("muted",l.toString()),k()}),n(),B()})}(window,document);
